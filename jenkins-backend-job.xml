<?xml version='1.1' encoding='UTF-8'?>
<project>
  <description>Build and push backend Docker image to ECR</description>
  <triggers>
    <scm>
      <ignorePostCommitHooks>false</ignorePostCommitHooks>
    </scm>
  </triggers>
  <scm class="hudson.plugins.git.GitSCM">
    <userRemoteConfigs>
      <hudson.plugins.git.UserRemoteConfig>
        <url>https://github.com/Kartik27baliyan/kartikTravelMemory.git</url>
      </hudson.plugins.git.UserRemoteConfig>
    </userRemoteConfigs>
    <branches>
      <hudson.plugins.git.BranchSpec>
        <name>*/main</name>
      </hudson.plugins.git.BranchSpec>
    </branches>
  </scm>
  <builders>
    <hudson.tasks.Shell>
      <command>cd backend
docker build -t kartiktravelmemory-backend .
aws ecr get-login-password --region ca-central-1 | docker login --username AWS --password-stdin $(aws sts get-caller-identity --query 'Account' --output text).dkr.ecr.ca-central-1.amazonaws.com
docker tag kartiktravelmemory-backend:latest $(aws sts get-caller-identity --query 'Account' --output text).dkr.ecr.ca-central-1.amazonaws.com/kartiktravelmemory-backend:latest
docker push $(aws sts get-caller-identity --query 'Account' --output text).dkr.ecr.ca-central-1.amazonaws.com/kartiktravelmemory-backend:latest</command>
    </hudson.tasks.Shell>
  </builders>
</project>
